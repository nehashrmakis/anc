import{r as o,j as e,$ as D,M as h}from"./app-DKcAQ6_-.js";import R from"./Header-BRF3mAJO.js";import U from"./Sidebar-BKfS1058.js";import"./sweetalert2.esm.all-BQIkj5Wb.js";import"./Dropdown-CQjxdwPE.js";import"./transition-D9AalLht.js";function Q(){const[d,v]=o.useState([]),[m,r]=o.useState({}),[p,x]=o.useState(""),[c,P]=o.useState(1),g=10,[l,j]=o.useState({id:"",name:"",contact_number:""}),[B,C]=o.useState(!1),[k,T]=o.useState("Add Port"),S=c*g,L=S-g;d.slice(L,S);const u=Math.ceil(d.length/g),M=()=>{const t=document.getElementById("add-agent-modal-more");if(!t)return;let a=h.getInstance(t);a||(a=new h(t)),a.hide(),document.querySelectorAll(".modal-backdrop").forEach(s=>s.remove()),document.body.classList.remove("modal-open"),document.body.style=""},f=t=>{const{name:a,value:s}=t.target;j(n=>({...n,[a]:s})),m&&r("")},A=()=>{const{name:t,email:a,contact_number:s,location:n}=l;return t.trim()?n.trim()?!0:(r("Location is required."),!1):(r("Port Name is required."),!1)},I=async t=>{var a;if(t.preventDefault(),!!A())try{const s=(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"),n=!!l.id,i=n?`/api/ports/${l.id}`:"/api/addport",E=await fetch(i,{method:n?"PUT":"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s,Accept:"application/json"},body:JSON.stringify(l)});if(E.ok)M(),x(n?"Port updated successfully!":"Port added successfully!"),j({id:"",name:"",location:""}),b();else{const q=await E.json();r(q.message||"Unknown error")}}catch(s){console.error("Error:",s),r(s.message||"An error occurred while submitting the form.")}},F=async t=>{try{const s=await(await fetch(`/api/ports/${t}/edit`)).json();j({id:s.depo.id,name:s.depo.name,location:s.depo.location}),C(!0),T("Edit Port");const n=document.getElementById("add-agent-modal-more");let i=h.getInstance(n);i||(i=new h(n)),i.show()}catch(a){console.error("Error fetching port data:",a)}},b=async()=>{try{const a=await(await fetch("/api/showsport")).json();v(a.depos||[]),P(1)}catch(t){console.error("Failed to fetch ports:",t),v([])}},N=t=>{t<1||t>u||P(t)};o.useEffect(()=>{b()},[]),o.useEffect(()=>{setTimeout(()=>{x("")},5e3)},[p]);const[y,_]=o.useState("");let $=t=>{var a=t.target.value.toLowerCase();_(a),console.log("Input Text:",a)};const O=async t=>{var a;try{const s=(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"),n=await fetch(`/api/ports/${t}/set-main`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s,Accept:"application/json"}});if(n.ok)b(),x("Main port updated successfully.");else{const i=await n.json();r(i.message||"Failed to set main port.")}}catch(s){console.error("Set Main Port Error:",s),r(s.message||"Unexpected error.")}},w=d.filter(t=>y===""?t:t.name.toLowerCase().includes(y)||t.location.toLowerCase().includes(y));return e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Port Listing"}),e.jsx(R,{}),e.jsx(U,{}),e.jsxs("main",{className:"app-content p-lg-5 product-invoice",children:[e.jsxs("div",{className:"new-invoice suplier-searchbar mt-4 mt-lg-4 d-flex align-items-start align-items-md-center align-items-md-center gap-2 gap-lg-5 flex-column flex-md-row flex-lg-row",children:[e.jsx("div",{className:"invoice-btn",children:e.jsx("a",{href:"#",className:"common_btn","data-bs-toggle":"modal","data-bs-target":"#add-agent-modal-more",children:"Add Port"})}),e.jsx("div",{className:"header-search suplier-location mt-3 mt-lg-0 mt-md-0",children:e.jsxs("div",{className:"input-group rounded-3",children:[e.jsx("input",{type:"text",className:"form-control border-0 ps-3",placeholder:"Port Location","aria-label":"Port Location","aria-describedby":"search-bar",id:"outlined-basic",onChange:$}),e.jsx("span",{className:"input-group-text border-0 rounded-3 pe-3",id:"search-bar",children:e.jsx("i",{className:"fa fa-location-arrow"})})]})})]}),e.jsxs("div",{className:"product-list-table suplier-list-table mt-3 mt-lg-5 port_table",children:[p&&e.jsx("div",{className:"alert alert-success",children:p}),e.jsxs("table",{className:"mb-3",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Port Name"}),e.jsx("th",{children:"Location"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:w.length>0?w.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.name}),e.jsx("td",{children:e.jsx("span",{className:"color-golden",children:t.location})}),e.jsx("td",{children:e.jsxs("div",{class:"d-flex align-items-center gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-primary edit_btn",onClick:()=>F(t.id),"data-bs-toggle":"modal","data-bs-target":"#add-agent-modal-more",children:"Edit"}),t.is_main?e.jsx("span",{className:"badge bg-success main-btn",children:"Main Port"}):!d.some(a=>a.is_main)&&e.jsx("button",{type:"button",className:"btn set-main",onClick:()=>O(t.id),children:"Set as Main"})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center",children:"No port found."})})})]})]}),u>1&&e.jsx("nav",{"aria-label":"Page navigation example",children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${c===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>N(c-1),children:e.jsx("i",{class:"fa-solid fa-angle-left"})})}),[...Array(u)].map((t,a)=>e.jsx("li",{className:`page-item ${c===a+1?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>N(a+1),children:a+1})},a)),e.jsx("li",{className:`page-item ${c===u?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>N(c+1),children:e.jsx("i",{class:"fa-solid fa-angle-right"})})})]})})]}),e.jsx("div",{className:"modal fade",id:"add-agent-modal-more",tabIndex:"-1","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content p-3 p-lg-4 rounded-4 border-0",children:[e.jsxs("div",{className:"modal-header border-bottom-0 p-0",children:[e.jsx("h2",{className:"modal-title",children:k}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body p-0",children:e.jsx(e.Fragment,{children:e.jsxs("form",{className:"row p-3",onSubmit:I,children:[m&&typeof m=="string"&&e.jsx("div",{className:"alert alert-danger",children:m}),e.jsx("input",{type:"hidden",name:"id",value:l.id||"",onChange:f}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Port Name"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Port Name",name:"name",value:l.name,onChange:f})]}),e.jsxs("div",{className:"col-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Location"}),e.jsx("textarea",{className:"form-control",placeholder:"Location",name:"location",value:l.location,onChange:f})]}),e.jsx("div",{className:"col-12 text-center",children:e.jsx("input",{type:"submit",className:"common_btn",value:"Submit"})})]})})})]})})})]})}export{Q as default};
