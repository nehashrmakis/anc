import{r as i,j as e,$,M as g}from"./app-hkHtsVWY.js";import T from"./Header-B2u-Ke0U.js";import F from"./Sidebar-2qtfisrx.js";import"./Dropdown-DJHpTJ5L.js";import"./transition-BTqLGtpx.js";function V(){const[p,f]=i.useState([]),[m,c]=i.useState({}),[x,N]=i.useState(""),[r,v]=i.useState(1),u=10,[l,j]=i.useState({id:"",name:"",email:"",contact_number:"",location:""}),[q,_]=i.useState(!1),[C,S]=i.useState("Add Agent"),y=r*u,w=y-u,E=p.slice(w,y),h=Math.ceil(p.length/u),P=()=>{const a=document.getElementById("add-agent-modal-more");if(!a)return;let t=g.getInstance(a);t||(t=new g(a)),t.hide(),document.querySelectorAll(".modal-backdrop").forEach(s=>s.remove()),document.body.classList.remove("modal-open"),document.body.style=""},d=a=>{const{name:t,value:s}=a.target;j(n=>({...n,[t]:s})),m&&c("")},k=()=>{const{name:a,email:t,contact_number:s,location:n}=l;return a.trim()?t.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?s.trim()?n.trim()?!0:(c("Location is required."),!1):(c("Contact Number is required."),!1):(c("Please enter a valid email address."),!1):(c("Email is required."),!1):(c("Agent Name is required."),!1)},I=async a=>{if(a.preventDefault(),!!k())try{const t=!!l.id,s=t?`/api/agents/${l.id}`:"/api/addagent",o=await fetch(s,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(o.ok)P(),N(t?"Agent updated successfully!":"Agent added successfully!"),j({id:"",name:"",email:"",contact_number:"",location:""}),A();else{const M=await o.json();c(M.message||"Unknown error")}}catch(t){console.error("Error:",t),c(t.message||"An error occurred while submitting the form.")}},L=async a=>{try{const s=await(await fetch(`/api/agents/${a}/edit`)).json();j({id:s.agent.id,name:s.agent.name,email:s.agent.email,contact_number:s.agent.contact_number,location:s.agent.location}),_(!0),S("Edit Agent");const n=document.getElementById("add-agent-modal-more");let o=g.getInstance(n);o||(o=new g(n)),o.show()}catch(t){console.error("Error fetching agent data:",t)}},A=async()=>{try{const t=await(await fetch("/api/showdata")).json();f(t.agents||[]),v(1)}catch(a){console.error("Failed to fetch agents:",a),f([])}},b=a=>{a<1||a>h||v(a)};return i.useEffect(()=>{A()},[]),i.useEffect(()=>{setTimeout(()=>{N("")},5e3)},[x]),e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Agent Listing"}),e.jsx(T,{}),e.jsx(F,{}),e.jsxs("main",{className:"app-content p-lg-5 agent",children:[e.jsx("div",{className:"mt-0 mt-lg-4 agent-details",children:e.jsx("div",{className:"row align-items-center",children:e.jsx("div",{className:"col-6 col-lg-6",children:e.jsx("div",{className:"add-agent-btn",children:e.jsx("a",{href:"#",className:"common_btn rounded-2","data-bs-toggle":"modal","data-bs-target":"#add-agent-modal-more",children:"Add Agent"})})})})}),e.jsxs("div",{className:"suppliers-location-table agent-table mt-3 mt-lg-5",children:[x&&e.jsx("div",{className:"alert alert-success",children:x}),e.jsxs("table",{className:"mb-3",children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{colspan:"5",class:"text-end",children:"Invoice"}),e.jsx("th",{colspan:"3"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Agent Name"}),e.jsx("th",{children:"Location"}),e.jsx("th",{children:"Contact Number"}),e.jsx("th",{children:"Email"}),e.jsx("th",{class:"assign-vat text-center",children:"Assigned"}),e.jsx("th",{class:"assign-vat text-center",children:"Vat"}),e.jsx("th",{}),e.jsx("th",{})]})]}),e.jsx("tbody",{children:E.length>0?E.map(a=>{var t;return e.jsxs("tr",{children:[e.jsx("td",{children:a.name}),e.jsx("td",{children:e.jsx("span",{className:"color-golden",children:a.location})}),e.jsx("td",{children:a.contact_number}),e.jsx("td",{children:a.email}),e.jsxs("td",{className:"text-center",children:["  ",((t=a.invoice_assignments)==null?void 0:t.length)||0]}),e.jsx("td",{className:"text-center",children:a.invoice_assignments&&a.invoice_assignments.length>0?a.invoice_assignments.filter(s=>{var n;return(n=s.invoice)==null?void 0:n.vat_invoice}).length:0}),e.jsx("td",{children:e.jsx("div",{class:"edit-compare-btn text-end",children:e.jsx("button",{type:"button",className:"btn btn-primary edit_btn",onClick:()=>L(a.id),"data-bs-toggle":"modal","data-bs-target":"#add-agent-modal-more",children:"Edit"})})}),e.jsx("td",{children:e.jsxs("div",{class:"agent-detail-btn text-end",children:[" ",e.jsx("a",{href:`/agents/${a.id}/invoices`,className:"common_btn",children:"Details"})]})})]},a.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center",children:"No agents found."})})})]})]}),h>1&&e.jsx("nav",{"aria-label":"Page navigation example",children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${r===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>b(r-1),children:e.jsx("i",{class:"fa-solid fa-angle-left"})})}),[...Array(h)].map((a,t)=>e.jsx("li",{className:`page-item ${r===t+1?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>b(t+1),children:t+1})},t)),e.jsx("li",{className:`page-item ${r===h?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>b(r+1),children:e.jsx("i",{class:"fa-solid fa-angle-right"})})})]})})]}),e.jsx("div",{className:"modal fade",id:"add-agent-modal-more",tabIndex:"-1","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content p-3 p-lg-4 rounded-4 border-0",children:[e.jsxs("div",{className:"modal-header border-bottom-0 p-0",children:[e.jsx("h2",{className:"modal-title",children:C}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body p-0",children:e.jsx(e.Fragment,{children:e.jsxs("form",{className:"row p-3",onSubmit:I,children:[m&&typeof m=="string"&&e.jsx("div",{className:"alert alert-danger",children:m}),e.jsx("input",{type:"hidden",name:"id",value:l.id||"",onChange:d}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Agent Name"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Agent Name",name:"name",value:l.name,onChange:d})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsx("input",{type:"email",className:"form-control",placeholder:"Email",name:"email",value:l.email,onChange:d})]}),e.jsxs("div",{className:"col-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Phone"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Phone",name:"contact_number",value:l.contact_number,onChange:d})]}),e.jsxs("div",{className:"col-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Location"}),e.jsx("textarea",{className:"form-control",placeholder:"Location",name:"location",value:l.location,onChange:d})]}),e.jsx("div",{className:"col-12 text-center",children:e.jsx("input",{type:"submit",className:"common_btn",value:"Submit"})})]})})})]})})})]})}export{V as default};
