import{r as h,j as e,$ as f,Y as g}from"./app-hkHtsVWY.js";import A from"./Header-B2u-Ke0U.js";import S from"./Sidebar-2qtfisrx.js";import{S as c}from"./sweetalert2.esm.all-BQIkj5Wb.js";import"./Dropdown-DJHpTJ5L.js";import"./transition-BTqLGtpx.js";function R({agent:i,invoices:x}){const[a,o]=h.useState(x),[j,k]=h.useState([]),p=t=>{const n=a.map(s=>{if(s.id===t){const r=[...s.misc_invoices||[],{invoice:"",remark:""}];return{...s,misc_invoices:r}}return s});o(n)},l=(t,n,s,r)=>{const b=a.map(d=>{if(d.id===t){const v=(d.misc_invoices||[]).map((m,y)=>y===n?{...m,[s]:r}:m);return{...d,misc_invoices:v}}return d});o(b)},u=async t=>{const n=a.find(s=>s.id===t);try{(await fetch(`/agents/${i.id}/invoices/${t}/misc`,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({misc_invoices:n.misc_invoices})})).ok?c.fire({title:"Success!",text:"Misc invoice rows added successfully.",icon:"success",confirmButtonText:"OK"}):c.fire({title:"Missing Fields",text:"Please make sure you have entered all mandatory fields.",icon:"warning",confirmButtonText:"OK"})}catch(s){console.error("Save error:",s),c.fire({title:"Error",text:"An unexpected error occurred. Please try again later.",icon:"error",confirmButtonText:"OK"})}},N=async t=>{try{(await fetch(`/agents/${i.id}/invoices/${t}/inventory`,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).ok?(await c.fire({title:"Success!",text:"Added to Final Inventory!",icon:"success",confirmButtonText:"OK"}),window.location.href="/inventory-category"):c.fire({title:"Failed!",text:"Failed to add. Please try again.",icon:"warning",confirmButtonText:"OK"})}catch(n){console.error("Inventory error:",n),c.fire({title:"Error!",text:"An unexpected error occurred.",icon:"error",confirmButtonText:"OK"})}};return e.jsxs(e.Fragment,{children:[e.jsx(f,{title:`Invoices for ${i.name}`}),e.jsx(A,{}),e.jsx(S,{}),e.jsxs("main",{className:"app-content p-lg-5 agent",children:[e.jsx("div",{className:"mt-0 mt-lg-4 agent-details",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-6 col-lg-7",children:e.jsx("div",{className:"agent-heading",children:e.jsx("h2",{children:i.name})})}),e.jsx("div",{className:"col-md-6 col-lg-5",children:e.jsx("div",{className:"category-btn text-end",children:e.jsx("a",{className:"btn btn-secondary mt-2 ms-3",href:"/agents",children:"â† Back to Agents"})})})]})}),e.jsx("div",{className:"suppliers-location-table compare-invoice-table mt-2 mt-lg-4",children:e.jsxs("table",{className:"mb-3",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"PO"}),e.jsx("th",{children:"CONTAINER"}),e.jsx("th",{children:"Supplier Name"}),e.jsx("th",{children:"DEPO"}),e.jsx("th",{children:"ETD"}),e.jsx("th",{children:"ETA"}),e.jsx("th",{className:"vat-inv",children:"VAT INV NO"}),e.jsx("th",{className:"misc-remarks",children:e.jsx("table",{className:"table-prod prod-list",children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"mis-invoice px-0",children:"Misc Invoice"}),e.jsx("td",{className:"remarks ps-0",children:"Remarks"})]})})})}),e.jsxs("th",{colSpan:"2",className:"clearence-inv",children:["Clearance",e.jsx("br",{}),"inv no."]}),e.jsx("th",{colSpan:"2",className:"clearence-inv",children:"Action"})]})}),e.jsx("tbody",{children:a.length>0?a.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.po_number}),e.jsx("td",{children:(t.containers||[]).length>0?t.containers.map((n,s)=>e.jsx("span",{className:"d-block",children:n.container_id},s)):e.jsx("span",{children:"N/A"})}),e.jsx("td",{children:t.supplier}),e.jsx("td",{children:t.arrival_depo}),e.jsx("td",{children:t.etd||"N/A"}),e.jsx("td",{children:t.landing_date||"N/A"}),e.jsx("td",{className:"vat-inv-data",children:e.jsx("input",{type:"text",value:t.vat_invoice||"",className:"form-control",disabled:!0})}),e.jsx("td",{className:"prod-table-outer px-0 msc-in-detail",children:e.jsx("table",{className:"table-prod prod-list",children:e.jsxs("tbody",{children:[(t.misc_invoices||[]).map((n,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"mis-invoice py-0",children:e.jsx("input",{type:"text",className:"form-control",value:n.invoice,onChange:r=>l(t.id,s,"invoice",r.target.value)})}),e.jsx("td",{className:"remarks py-0",children:e.jsx("input",{type:"text",className:"form-control demage-container",value:n.remark,onChange:r=>l(t.id,s,"remark",r.target.value)})})]},s)),e.jsx("tr",{children:e.jsxs("td",{colSpan:"2",className:"text-end",children:[e.jsx("button",{type:"button",className:"add-rows-btn border-0 rounded-2 me-2",onClick:()=>p(t.id),children:"+ Add Row"}),e.jsx("button",{type:"button",className:"btn btn-success btn-sm",onClick:()=>u(t.id),children:"Save"})]})})]})})}),e.jsx("td",{className:"clearence-inv-detail",children:t.clearance_invoice_no||"N/A"}),e.jsx("td",{className:"text-end clearence-inv-detail",children:e.jsx(g,{href:route("agent.invoice.edit",{agent:i.id,invoice:t.id}),children:e.jsx("button",{className:"edit-btn border-0",children:e.jsx("img",{src:"/assets/img/icons/edit.png",alt:"edit"})})})}),e.jsx("td",{children:t.already_in_inventory||j.includes(t.id)?e.jsx("button",{className:"btn border-0 text-success",disabled:!0,children:"Already Added"}):e.jsx("button",{className:"btn border-0",onClick:()=>N(t.id),children:"Add to Inventory"})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"12",className:"text-center",children:"No invoices assigned."})})})]})})]})]})}export{R as default};
