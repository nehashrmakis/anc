import{q as F,r as d,m as g,j as e,$ as D,Y as I}from"./app-DKcAQ6_-.js";import M from"./Header-BRF3mAJO.js";import O from"./Sidebar-BKfS1058.js";import"./Dropdown-CQjxdwPE.js";import"./transition-D9AalLht.js";function K(){const{invoices:A,filters:p,agentList:C=[],portList:q=[]}=F().props,[o,E]=d.useState((p==null?void 0:p.search)||""),[x,b]=d.useState(null),[N,y]=d.useState({}),f=C,_=q,[c,v]=d.useState(""),[u,j]=d.useState(""),[w,S]=d.useState(""),k=(s,a)=>{j(s),S(a),new window.bootstrap.Modal(document.getElementById("assign-product")).show()};d.useEffect(()=>{const s=setTimeout(()=>{const a={};o.trim()&&(a.search=o.trim()),g.get(route("invoice.index"),a,{preserveState:!0,replace:!0})},400);return()=>clearTimeout(s)},[o]);const P=()=>!u||!c||!w?(alert("Please fill all required fields."),!1):!0,L=async s=>{const a=N[s];try{await fetch(`/api/update-product-quantity/${s}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({qty:a})}),b(null),g.reload()}catch(l){console.error("Failed to update quantity:",l)}},T=async s=>{var h;if(s.preventDefault(),!P())return;const a=f.find(n=>n.id==c),l=(a==null?void 0:a.name)||"",t=new FormData;t.append("invoice_id",w),t.append("invoice_agent",u),t.append("agent_id",c),t.append("agent_name",l);const m=await fetch("/api/addport",{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:t}),r=await m.text();if(m.ok){console.log("✅ Response OK:",r);const n=document.getElementById("assign-product");if((h=window.bootstrap)!=null&&h.Modal&&n){let i=window.bootstrap.Modal.getInstance(n);i||(i=new window.bootstrap.Modal(n)),i.hide()}else if(n){n.classList.remove("show"),n.style.display="none",n.setAttribute("aria-hidden","true"),document.body.classList.remove("modal-open");const i=document.querySelector(".modal-backdrop");i&&i.remove()}v(""),j(""),S(""),g.reload()}else console.error("❌ Response Error:",r),alert("Something went wrong while assigning the agent.")};return e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Invoice Listing"}),e.jsx(M,{}),e.jsx(O,{}),e.jsxs("main",{className:"app-content p-lg-5 inventory-category",children:[e.jsxs("div",{className:"d-flex flex-wrap gap-3 mb-4 align-items-center",children:[e.jsx(I,{href:route("invoice.create"),className:"common_btn",children:"Add New Invoice"}),e.jsx("div",{className:"header-search suplier-location",children:e.jsxs("div",{className:"input-group rounded-3",children:[e.jsx("input",{type:"text",className:"form-control border-0 ps-3",placeholder:"Search Invoice",value:o,onChange:s=>E(s.target.value)}),e.jsx("span",{className:"input-group-text border-0 rounded-3 pe-3",children:e.jsx("i",{className:"fa fa-location-arrow"})})]})})]}),e.jsx("div",{className:"suppliers-location-table",children:e.jsxs("table",{className:"mb-3",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice"}),e.jsx("th",{children:"PO"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Port"}),e.jsx("th",{children:"Arrival date"}),e.jsx("th",{className:"text-center",children:"Transit"}),e.jsx("th",{className:"prod-table-outer",children:e.jsx("table",{className:"table-prod",children:e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"container-detail-id",children:"Containers ID"}),e.jsx("th",{className:"product-name",children:"Product"}),e.jsx("th",{className:"product-name",children:"Marking"}),e.jsx("th",{className:"product-size",children:"Size"}),e.jsx("th",{className:"product-weight",children:"Weight"}),e.jsx("th",{className:"prod-qty",children:"Qty.(each)"}),e.jsx("th",{colSpan:"2",className:"prod-action",children:"Action"})]})})})})]})}),e.jsx("tbody",{children:A.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.invoice_number}),e.jsx("td",{children:s.po_number}),e.jsx("td",{children:s.supplier}),e.jsx("td",{children:s.agent}),e.jsx("td",{children:s.arrival_date}),e.jsx("td",{className:"text-center",children:s.transit}),e.jsx("td",{className:"prod-table-outer",children:s.containers.map((a,l)=>e.jsx("table",{className:`table-prod prod-list ${l>0?"mt-3":""}`,children:e.jsx("tbody",{children:a.products.map((t,m)=>e.jsxs("tr",{children:[m===0&&e.jsx("td",{className:"container-detail-id",rowSpan:a.products.length,children:a.container_number}),e.jsx("td",{className:"product-name",children:t.name}),e.jsx("td",{className:"product-name",children:t.marking}),e.jsx("td",{className:"product-size",children:t.size}),e.jsx("td",{className:"product-weight",children:t.weight}),e.jsx("td",{className:"prod-qty",children:e.jsx("input",{type:"number",value:x===t.id?N[t.id]??t.qty:t.qty,onChange:r=>y(h=>({...h,[t.id]:r.target.value})),disabled:x!==t.id,className:"form-control",style:{width:"80px"}})}),e.jsx("td",{children:s.is_assigned?e.jsx("div",{className:"action-btn d-flex flex-column gap-2",children:x===t.id?e.jsx("button",{className:"edit-btn rounded-2 py-1",onClick:()=>L(t.id),children:"Update"}):e.jsx("button",{className:"edit-btn rounded-2 py-1",onClick:()=>{b(t.id),y(r=>({...r,[t.id]:t.qty}))},children:"Edit"})}):null})]},t.id))})},a.id))}),e.jsxs("td",{className:"prod-action",children:[!s.is_assigned&&e.jsx("div",{className:"assign-now-btn mb-2",children:e.jsx(I,{href:route("invoice.edit",s.id),className:"assign-btn border-0 rounded-2 px-2 py-1 text-decoration-none d-inline-block text-white",children:"Edit Invoice"})}),e.jsx("div",{className:"assign-now-btn",children:s.is_assigned?e.jsx("button",{className:"assign-btn border-0 rounded-2 px-2 py-1 bg-success text-white",disabled:!0,children:"Assigned"}):e.jsx("button",{className:"assign-btn border-0 rounded-2 px-2 py-1","data-bs-toggle":"modal","data-bs-target":"#assign-product",onClick:()=>k(s.agent,s.id),children:"Assign Now"})})]})]},s.id))})]})})]}),e.jsx("div",{className:"modal fade shipment-more assign-product",id:"assign-product",tabIndex:"-1","aria-labelledby":"assign-productLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content p-3 p-lg-4 rounded-4",children:[e.jsxs("div",{className:"modal-header border-bottom-0 p-0",children:[e.jsx("h2",{className:"modal-title",id:"assign-productLabel",children:"Assign to Agent/Depo"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body p-0",children:e.jsxs("div",{className:"arrival-info assign-agent p-4 p-lg-5 mt-2 rounded-4",children:[e.jsx("h4",{children:"Change Arrival Info"}),e.jsxs("form",{className:"row mt-2 mt-lg-3 mt-xl-3 justify-content-center",onSubmit:T,children:[e.jsxs("div",{className:"col-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Update arrival port"}),e.jsxs("select",{className:"form-select",value:u,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"",children:"Select port"}),_.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]})]}),e.jsxs("div",{className:"col-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Agent"}),e.jsxs("select",{className:"form-select",value:c,onChange:s=>v(s.target.value),children:[e.jsx("option",{value:"",children:"Select agent"}),f.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx("div",{className:"col-12 col-md-4 text-center",children:e.jsx("button",{type:"submit",className:"common_btn",children:"Assign Now"})})]})]})})]})})})]})}export{K as default};
