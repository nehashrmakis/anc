import{q as R,r as l,m as b,j as e,$ as D,Y as E}from"./app-hkHtsVWY.js";import O from"./Header-B2u-Ke0U.js";import Q from"./Sidebar-2qtfisrx.js";import"./Dropdown-DJHpTJ5L.js";import"./transition-BTqLGtpx.js";function X(){const{invoices:N,filters:r,agentList:k=[],portList:q=[]}=R().props,[c,P]=l.useState((r==null?void 0:r.search)||""),[u,v]=l.useState(null),[f,y]=l.useState({}),w=k,S=q,[m,I]=l.useState(""),[h,_]=l.useState((r==null?void 0:r.port)||""),[j,g]=l.useState(""),[A,C]=l.useState(""),L=(s,a)=>{g(s),C(a),new window.bootstrap.Modal(document.getElementById("assign-product")).show()};l.useEffect(()=>{const s=setTimeout(()=>{const t={};c.trim()&&(t.search=c.trim()),h&&(t.port=h),b.get(route("invoice.index"),t,{preserveState:!0,replace:!0})},400),a=document.getElementById("assign-product"),n=()=>{const t=new URL(window.location.href);t.search="",window.history.replaceState({},"",t)};return a&&a.addEventListener("hidden.bs.modal",n),()=>{clearTimeout(s),a&&a.removeEventListener("hidden.bs.modal",n)}},[c,h]);const T=()=>!j||!m||!A?(alert("Please fill all required fields."),!1):!0,F=async s=>{const a=f[s];try{await fetch(`/api/update-product-quantity/${s}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({qty:a})}),v(null),b.reload()}catch(n){console.error("Failed to update quantity:",n)}},M=async s=>{var x;if(s.preventDefault(),!T())return;const a=w.find(d=>d.id==m),n=(a==null?void 0:a.name)||"",t=new FormData;t.append("invoice_id",A),t.append("invoice_agent",j),t.append("agent_id",m),t.append("agent_name",n);const p=await fetch("/addport",{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:t}),i=await p.text();if(p.ok){console.log("Response OK:",i);const d=document.getElementById("assign-product");if((x=window.bootstrap)!=null&&x.Modal&&d){let o=window.bootstrap.Modal.getInstance(d);o||(o=new window.bootstrap.Modal(d)),o.hide()}else if(d){d.classList.remove("show"),d.style.display="none",d.setAttribute("aria-hidden","true"),document.body.classList.remove("modal-open");const o=document.querySelector(".modal-backdrop");o&&o.remove()}I(""),g(""),C(""),b.reload()}else console.error("❌ Response Error:",i),alert("Something went wrong while assigning the agent.")};return e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Invoice Listing"}),e.jsx(O,{}),e.jsx(Q,{}),e.jsxs("main",{className:"app-content p-lg-5 inventory-category",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"d-flex gap-2 add-invo-search",children:[e.jsx(E,{href:route("invoice.create"),className:"common_btn",children:"Add New Invoice"}),e.jsx("div",{className:"header-search suplier-location",children:e.jsxs("div",{className:"input-group rounded-3",children:[e.jsx("input",{type:"text",className:"form-control border-0 ps-3",placeholder:"Search Invoice",value:c,onChange:s=>P(s.target.value)}),e.jsx("span",{className:"input-group-text border-0 rounded-3 pe-3",children:e.jsx("i",{className:"fa fa-location-arrow"})})]})})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("select",{className:"form-select",value:h,onChange:s=>_(s.target.value),children:[e.jsx("option",{value:"",children:"All Ports"}),S.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]})})]}),e.jsx("div",{className:"suppliers-location-table",children:e.jsxs("table",{className:"mb-3",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice"}),e.jsx("th",{children:"PO"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Port"}),e.jsx("th",{children:"Arrival date"}),e.jsx("th",{className:"text-center",children:"Transit"}),e.jsx("th",{className:"prod-table-outer",children:e.jsx("table",{className:"table-prod",children:e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"container-detail-id",children:"Containers ID"}),e.jsx("th",{className:"product-name",children:"Product"}),e.jsx("th",{className:"product-marking",children:"Marking"}),e.jsx("th",{className:"product-size",children:"Size"}),e.jsx("th",{className:"product-weight",children:"Weight"}),e.jsx("th",{className:"prod-qty",children:"Qty.(each)"}),e.jsx("th",{colSpan:"2",className:"prod-action",children:"Action"})]})})})})]})}),e.jsx("tbody",{children:N.length>0?N.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.invoice_number}),e.jsx("td",{children:s.po_number}),e.jsx("td",{children:s.supplier}),e.jsx("td",{children:s.agent}),e.jsx("td",{children:s.arrival_date}),e.jsx("td",{className:"text-center",children:s.transit}),e.jsx("td",{className:"prod-table-outer",children:s.containers.map((a,n)=>e.jsx("table",{className:`table-prod prod-list ${n>0?"mt-3":""}`,children:e.jsx("tbody",{children:a.products.map((t,p)=>e.jsxs("tr",{children:[p===0&&e.jsx("td",{className:"container-detail-id",rowSpan:a.products.length,children:a.container_number}),e.jsx("td",{className:"product-name",children:t.name}),e.jsx("td",{className:"product-marking",children:t.marking}),e.jsx("td",{className:"product-size",children:t.size}),e.jsx("td",{className:"product-weight",children:t.weight}),e.jsx("td",{className:"prod-qty",children:e.jsx("input",{type:"number",value:u===t.id?f[t.id]??t.qty:t.qty,onChange:i=>y(x=>({...x,[t.id]:i.target.value})),disabled:u!==t.id,className:"form-control",style:{width:"80px"}})}),e.jsx("td",{className:"prod-action",children:s.is_assigned?e.jsx("div",{className:"action-btn d-flex flex-column gap-2",children:u===t.id?e.jsx("button",{className:"edit-btn rounded-2 py-1 update",onClick:()=>F(t.id),children:"Update"}):e.jsx("button",{className:"edit-btn rounded-2 py-1",onClick:()=>{v(t.id),y(i=>({...i,[t.id]:t.qty}))},children:"Edit"})}):null})]},t.id))})},a.id))}),e.jsx("td",{className:"prod-action",children:e.jsxs("div",{className:"assign-now-btn mb-2 d-flex gap-2",children:[!s.is_assigned&&e.jsx(E,{href:route("invoice.edit",s.id),className:"assign-btn border-0 rounded-2 px-2 py-1 text-decoration-none d-inline-block text-white",children:e.jsx("i",{class:"fa-solid fa-pen-to-square"})}),s.is_assigned?e.jsx("button",{className:"assign-btn border-0 rounded-2 px-2 py-1 bg-success text-white",disabled:!0,children:"Assigned"}):e.jsx("button",{className:"assign-btn border-0 rounded-2 px-2 py-1","data-bs-toggle":"modal","data-bs-target":"#assign-product",onClick:()=>L(s.agent,s.id),children:"Assign Now"})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center text-muted",children:"No invoices found matching your search."})})})]})})]}),e.jsx("div",{className:"modal fade shipment-more assign-product",id:"assign-product",tabIndex:"-1","aria-labelledby":"assign-productLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content p-3 p-lg-4 rounded-4",children:[e.jsxs("div",{className:"modal-header border-bottom-0 p-0",children:[e.jsx("h2",{className:"modal-title",id:"assign-productLabel",children:"Assign to Agent/Depo"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body p-0",children:e.jsxs("div",{className:"arrival-info assign-agent p-4 p-lg-5 mt-2 rounded-4",children:[e.jsx("h4",{children:"Change Arrival Info"}),e.jsxs("form",{className:"row mt-2 mt-lg-3 mt-xl-3 justify-content-center",onSubmit:M,children:[e.jsxs("div",{className:"col-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Update arrival port"}),e.jsxs("select",{className:"form-select",value:j,onChange:s=>g(s.target.value),children:[e.jsx("option",{value:"",children:"Select port"}),S.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]})]}),e.jsxs("div",{className:"col-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Agent"}),e.jsxs("select",{className:"form-select",value:m,onChange:s=>I(s.target.value),children:[e.jsx("option",{value:"",children:"Select agent"}),w.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx("div",{className:"col-12 col-md-4 text-center",children:e.jsx("button",{type:"submit",className:"common_btn",children:"Assign Now"})})]})]})})]})})})]})}export{X as default};
